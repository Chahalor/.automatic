# Big Header

# This is a Makefile for the V2 initializer. It is used to compile the
# initializer and its dependencies. It is also used to run the initializer
# and its tests.

# This Makefile is designed to be run on a Unix-like system. It has been
# tested on Ubuntu 18.04. It should work on other Unix-like systems as well.

# This Makefile requires the following tools:
# - make
# - gcc
# - clang
# - clang-format

# This Makefile has the following targets:
# - all: Compiles the initializer and its dependencies.
# - compile: Compiles the initializer and its dependencies.
# - clean: Removes all files generated by this Makefile.
# - fclean: Removes all files generated by this Makefile and the initializer.
# - re: Removes all files generated by this Makefile and compiles the
#       initializer and its dependencies.
# - run: Runs the initializer.
# - test: Runs the tests for the initializer.

NAME := initializer

CC := gcc
CFLAGS := -Wall -Wextra -Werror -std=c99 -pedantic
DEBUG := -g3
RELEASE := -O3

DIR_SRC := src
DIR_OBJ := .obj
DIR_INC := include
DIR_TEMPLATE := templates

SRC =	initializer.c 

OBJ = $(SRC:%.c=$(DIR_OBJ)/%.o)

all: $(NAME)

compile: $(OBJ)
	@mkdir -p $(DIR_OBJ)

$(DIR_OBJ)/%.o: $(DIR_SRC)/%.c
	@mkdir -p $(@D)
	$(CC) $(CFLAGS) -I$(DIR_INC) -I$(DIR_TEMPLATE) -c $< -o $@

$(NAME): compile
	$(CC) $(CFLAGS) -I$(DIR_INC) -I$(DIR_TEMPLATE) $(OBJ) -o $(NAME)

clean:
	rm -rf $(DIR_OBJ)

fclean: clean
	rm -f $(NAME)

re: fclean all

run: $(NAME)
	./$(NAME)

test:
	$(eval $(CFLAGS) = $(CFLAGS) $(DEBUG))
	$(eval $(NAME) := ../.test/$(NAME))
	./$(NAME) test

debug: all
	$(eval $(CFLAGS) += $(DEBUG))
	@echo "Debug mode enabled"

.PHONY: all compile clean fclean re run test